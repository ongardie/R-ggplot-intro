---
pagetitle: 'Introduction to R/ggplot'
output:
  slidy_presentation:
    font_adjustment: -1
    fig_width: 5
    fig_height: 3
---

Introduction to plotting with R and ggplot2
===========================================

Diego Ongaro

September 2014

\
\
\
\

<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work is licensed under the <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.

Getting Started
===============

* Run `R` for interactive REPL

* Getting help

    ```{r, eval=FALSE}
?length
?'+'
??zip
```

* Installing libraries

    ```{r, eval=FALSE}
install.packages('ggplot2')
```

* Run scripts using `Rscript` from command line

    ```sh
Rscript plots.R
```


R Data Types
============
* primitives
* vectors
* matrices (won't cover)
* lists
* data frames

Primitives
==========
```{r}
3/2
TRUE
T
FALSE
F
'hello'
sprintf('I have %d apples and %0.02f bananas', 2, pi)
```

Vectors
=======
```{r}
(vector = c(5, 3, 9)) # extra parens to print value
length(vector)
```

Flat, uniform:
```{r}
c(5, 3, 9, FALSE, c(7, 2))
10:20
rep(7, 5)
seq(10, 12, .5)
```

Nearly all operations vectorized:
```{r}
vector * 3
vector + 6
vector == 3
```

Lists
=====

* Sometimes a (Python) list, sometimes a map
* Like a PHP array

```{r}
values = list(1, 'apple', 4, 'me')
values[[2]]
mapping = list(x=3, y=TRUE, values=values)
mapping[['x']]
mapping$y
mapping$values[[4]]
ls(mapping)
```

Data Frames
===========

* Like a database table

    ```{r, results='asis'}
df = data.frame(x=c('a', 'b'), y=c(1, 2))
fmt = knitr::kable # renders data frame nicely
fmt(df)
df$y

somecars = mtcars[1:5,]
fmt(somecars)
```

*  Projection - vector of column names after the comma

    ```{r, results='asis'}
fmt(somecars[, c('mpg', 'hp', 'gear')]) # projection
```

* Selection - vector of booleans before the comma

    ```{r, results='asis'}
fmt(somecars[somecars$mpg > 21, ])
```

* Combined

    ```{r, results='asis'}
fmt(somecars[somecars$mpg > 21, c('hp', 'gear')])
```

Our First Scatter Plot
======================

```{r}
library('ggplot2')
(g = ggplot(mtcars) +
     geom_point(aes(x=hp, y=mpg)))
```

Better zero-base those axes!
```{r}
# This makes sure (0,0) is shown in the graph. Alternatively, use
# coord_cartesian() to control the axes' upper and lower bounds.
(g = g + expand_limits(x = 0, y = 0))
```

(BTW, don't use `qplot`; always spell it out with `ggplot`.)

A Grouped Bar Graph
===================

Steal allocator dataset from Steve Rumble:
```{r, results='asis'}
alloc = read.table('allocators.data', header=TRUE)
fmt(alloc)
```

Pretty easy to plot first workload:
```{r, fig.width=8, fig.height=3}
# geom_bar defaults to using frequency for y value; stat='identity' tells it to
# use the y value specified.
(g = ggplot(alloc) +
    geom_bar(aes(x=Allocator, y=W1),
             stat='identity',
             width=.2))
```

To plot all the workloads, we first need to blow up the data frame from the
current wide format to a long format:
```{r, results='asis'}
library(reshape2)
alloclong = melt(alloc,
    id.vars = c('Allocator'),
    variable.name='workload',
    value.name='GB')
fmt(alloclong[1:10,])
```

Now we can plot this long-format data:
```{r, fig.width=8, fig.height=3}
(g = ggplot(alloclong) +
    geom_bar(aes(x=Allocator, y=GB, fill=workload),
             stat='identity',
             position='dodge')) # without dodge, bars would stack
```

Too much rainbow? Built-in [ColorBrewer](http://colorbrewer2.org/).
```{r, fig.width=8, fig.height=3}
(g = g + scale_fill_brewer(palette='Set1'))
```

TODO
====

Types of plots:

* CDF
* John-CDF / Ousterplot
* disk/flash/dram "graph" from the case for RAMCloud?

Concepts:

* aes
* stat
* geom
* theme

Features:

* Legends
* Error Bars (ddply)
* Facets
* log scale
* plot a function

Limitations:

* Two y axes

Loading data:

* read.csv
* sqlite
